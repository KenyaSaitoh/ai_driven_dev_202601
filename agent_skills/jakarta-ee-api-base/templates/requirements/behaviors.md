# [PROJECT_NAME] - システム振る舞い仕様書

テンプレートパス: templates/requirements/behaviors.md  
コピー先: {spec_directory}/requirements/behaviors.md  
システム名: [SYSTEM_NAME]  
バージョン: 1.0.0  
最終更新日: [DATE]

---

## 1. 概要

本文書は、[PROJECT_NAME]システムの要件定義を外形的に捉えた振る舞い仕様書である。E2Eテスト用のシナリオを記述し、システム全体（API層を含む）の受入基準を定義する。

**テスト対象:**
* API層（Resource、JAX-RS）
* HTTPリクエスト/レスポンス
* 認証・認可（JWT、Cookie）
* 複数API間の連携
* 実際のDBアクセス
* 外部システム連携

**テスト対象外:**
* Service層の内部的なビジネスロジック（basic_design/behaviors.mdで記述）
* DAO層の実装詳細（basic_design/behaviors.mdで記述）

**関連ドキュメント:**
* [requirements.md](requirements.md) - 要件定義書（What & Why）
* [../basic_design/behaviors.md](../basic_design/behaviors.md) - 結合テスト用の振る舞い仕様書（Service層以下）
* [../basic_design/functional_design.md](../basic_design/functional_design.md) - システム機能設計書
* [../basic_design/architecture_design.md](../basic_design/architecture_design.md) - アーキテクチャ設計書

---

## 2. タスク一覧とリンク

注意: 以下は、詳細設計配下の単体テスト用behaviors.md（templates/detailed_design/behaviors.mdから生成）へのリンクです。

| タスクID | タスク名 | 単体テスト用behaviors.md |
|---------|---------|----------------------|
| FUNC_001 | [機能名1] | [../detailed_design/FUNC_001/behaviors.md](../detailed_design/FUNC_001/behaviors.md) |
| FUNC_002 | [機能名2] | [../detailed_design/FUNC_002/behaviors.md](../detailed_design/FUNC_002/behaviors.md) |

---

## 3. 共通処理の振る舞い

### 3.1 認証・認可

| シナリオID | 説明 | Given（前提条件） | When（操作） | Then（期待結果） |
|-----------|------|----------------|------------|---------------|
| AUTH-001 | [認証シナリオ] | [前提条件] | [操作] | [期待結果] |
| AUTHZ-001 | [認可シナリオ] | [前提条件] | [操作] | [期待結果] |

### 3.2 エラーハンドリング

| シナリオID | 説明 | Given（前提条件） | When（操作） | Then（期待結果） |
|-----------|------|----------------|------------|---------------|
| ERR-001 | [エラーシナリオ] | [前提条件] | [操作] | [期待結果] |

### 3.3 トランザクション管理

| シナリオID | 説明 | Given（前提条件） | When（操作） | Then（期待結果） |
|-----------|------|----------------|------------|---------------|
| TXN-001 | [トランザクションシナリオ] | [前提条件] | [操作] | [期待結果] |

---

## 3. システム統合受入基準

### 3.1 E2Eシナリオ

| シナリオID | 説明 | ステップ | 受入基準 |
|-----------|------|---------|---------|
| E2E-001 | [シナリオ名] | 1. [STEP_1]<br/>2. [STEP_2]<br/>3. [STEP_3] | 全ステップが成功<br/>[追加基準] |
| E2E-002 | [シナリオ名] | 1. [STEP_1]<br/>2. [STEP_2] | 全ステップが成功<br/>[追加基準] |

---

## 4. データ整合性受入基準

### 4.1 外部キー整合性

| シナリオID | 説明 | 受入基準 |
|-----------|------|---------|
| DATA-001 | [テーブル1]と[テーブル2]の整合性 | [整合性基準] |
| DATA-002 | [テーブル3]と[テーブル4]の整合性 | [整合性基準] |

---

## 5. パフォーマンス受入基準

### 5.1 レスポンスタイム

| シナリオID | カテゴリ | 受入基準 |
|-----------|---------|---------|
| PERF-001 | [API_NAME_1] | [XXX]ms以内（95パーセンタイル） |
| PERF-002 | [API_NAME_2] | [XXX]ms以内（95パーセンタイル） |

### 5.2 スループット

| シナリオID | 説明 | 受入基準 |
|-----------|------|---------|
| PERF-TH-001 | 同時リクエスト処理能力 | [XXX]リクエスト/秒を処理可能 |
| PERF-TH-002 | 大量データ取得 | [データ量]を[時間]以内に取得 |

---

## 6. セキュリティ受入基準

### 6.1 認証・認可

| シナリオID | 説明 | 受入基準 |
|-----------|------|---------|
| SEC-AUTH-001 | 未認証ユーザーのアクセス拒否 | 401 Unauthorized |
| SEC-AUTH-002 | 認証トークンの検証 | 不正なトークンは拒否 |
| SEC-AUTHZ-001 | 権限不足のユーザーのアクセス拒否 | 403 Forbidden |

### 6.2 データ保護

| シナリオID | 説明 | 受入基準 |
|-----------|------|---------|
| SEC-DATA-001 | パスワードのハッシュ化 | BCryptでハッシュ化されている |
| SEC-DATA-002 | 機密データの暗号化 | [暗号化方式]で暗号化されている |

---

## 7. 並行制御受入基準

### 7.1 楽観的ロック（該当する場合）

| シナリオID | 説明 | 受入基準 |
|-----------|------|---------|
| CONC-OPT-001 | 並行更新時のバージョン競合 | 後から更新したユーザーは409 Conflict |
| CONC-OPT-002 | バージョン番号の自動インクリメント | 更新ごとにバージョンが1増加 |

### 7.2 悲観的ロック（該当する場合）

| シナリオID | 説明 | 受入基準 |
|-----------|------|---------|
| CONC-PES-001 | 並行アクセス時のロック待機 | 先行トランザクション完了までロック待機 |
| CONC-PES-002 | ロックタイムアウト | タイムアウト時はエラーレスポンス |

---

## 8. E2Eシナリオ（Given-When-Then形式）

以下は、システム全体のE2Eテストシナリオです。タスク単位の単体テストシナリオについては、各detailed_design/{target}/behaviors.mdを参照してください。

### 8.X 機能 [FEATURE_ID]: [FEATURE_NAME]

### Scenario: [SCENARIO_NAME_1]

```gherkin
Given [前提条件]
When [アクション]
Then [期待される結果]
And [追加の期待結果]
```

* 受入基準:
  * [ ] [受入基準1]
  * [ ] [受入基準2]
  * [ ] [受入基準3]

### Scenario: [SCENARIO_NAME_2]

```gherkin
Given [前提条件]
When [アクション]
Then [期待される結果]
But [除外される結果]
```

### Scenario: [SCENARIO_NAME_3] (異常系)

```gherkin
Given [前提条件]
When [エラーを引き起こすアクション]
Then [エラーメッセージが表示される]
And [システムの状態は変更されない]
```

---

[必要に応じて追加の機能セクションを追加]

---

## 9. エラーシナリオ

[必要に応じて追加のエラーシナリオを記述]

| シナリオ | 期待される動作 | エラーコード |
|----------|---------------|-------------|
| [シナリオ1] | [期待される動作] | [CODE] |

---

## 10. 参考資料

* [requirements.md](requirements.md) - 要件定義書
* [functional_design.md](functional_design.md) - 機能設計書
* [architecture_design.md](architecture_design.md) - アーキテクチャ設計書

