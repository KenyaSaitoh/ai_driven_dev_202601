# [PROJECT_NAME] - システム振る舞い仕様書

ファイル名: behaviors.md（system/配下）  
システム名: [SYSTEM_NAME]  
バージョン: 1.0.0  
最終更新日: [DATE]

---

## 1. 概要

本文書は、[PROJECT_NAME]システム全体の振る舞い、共通処理の振る舞い、受入基準を記述する。システム統合テストシナリオ、共通機能の振る舞い、システム全体のパフォーマンス、セキュリティ、運用に関する受入基準を定義する。

* API固有の振る舞いは、各api/{api_id}/behaviors.mdを参照すること

* 関連ドキュメント:
  * [requirements.md](requirements.md) - 要件定義書（What & Why）
  * [functional_design.md](functional_design.md) - システム機能設計書（共通機能、ドメインモデル）
  * [architecture_design.md](architecture_design.md) - アーキテクチャ設計書
  * [data_model.md](data_model.md) - データモデル仕様書
  * [external_interface.md](external_interface.md) - 外部インターフェース仕様書

---

## 2. API一覧とリンク

| API ID | API名 | ベースパス | 振る舞い仕様書 |
|--------|------|----------|-------------|
| API_001 | [API名1] | /api/[path] | [../api/API_001/behaviors.md](../api/API_001/behaviors.md) |
| API_002 | [API名2] | /api/[path] | [../api/API_002/behaviors.md](../api/API_002/behaviors.md) |

---

## 3. 共通処理の振る舞い

### 3.1 認証・認可

| シナリオID | 説明 | Given（前提条件） | When（操作） | Then（期待結果） |
|-----------|------|----------------|------------|---------------|
| AUTH-001 | [認証シナリオ] | [前提条件] | [操作] | [期待結果] |
| AUTHZ-001 | [認可シナリオ] | [前提条件] | [操作] | [期待結果] |

### 3.2 エラーハンドリング

| シナリオID | 説明 | Given（前提条件） | When（操作） | Then（期待結果） |
|-----------|------|----------------|------------|---------------|
| ERR-001 | [エラーシナリオ] | [前提条件] | [操作] | [期待結果] |

### 3.3 トランザクション管理

| シナリオID | 説明 | Given（前提条件） | When（操作） | Then（期待結果） |
|-----------|------|----------------|------------|---------------|
| TXN-001 | [トランザクションシナリオ] | [前提条件] | [操作] | [期待結果] |

---

## 3. システム統合受入基準

### 3.1 エンドツーエンドシナリオ

| シナリオID | 説明 | ステップ | 受入基準 |
|-----------|------|---------|---------|
| E2E-001 | [シナリオ名] | 1. [STEP_1]<br/>2. [STEP_2]<br/>3. [STEP_3] | 全ステップが成功<br/>[追加基準] |
| E2E-002 | [シナリオ名] | 1. [STEP_1]<br/>2. [STEP_2] | 全ステップが成功<br/>[追加基準] |

---

## 4. データ整合性受入基準

### 4.1 外部キー整合性

| シナリオID | 説明 | 受入基準 |
|-----------|------|---------|
| DATA-001 | [テーブル1]と[テーブル2]の整合性 | [整合性基準] |
| DATA-002 | [テーブル3]と[テーブル4]の整合性 | [整合性基準] |

---

## 5. パフォーマンス受入基準

### 5.1 レスポンスタイム

| シナリオID | カテゴリ | 受入基準 |
|-----------|---------|---------|
| PERF-001 | [API_NAME_1] | [XXX]ms以内（95パーセンタイル） |
| PERF-002 | [API_NAME_2] | [XXX]ms以内（95パーセンタイル） |

### 5.2 スループット

| シナリオID | 説明 | 受入基準 |
|-----------|------|---------|
| PERF-TH-001 | 同時リクエスト処理能力 | [XXX]リクエスト/秒を処理可能 |
| PERF-TH-002 | 大量データ取得 | [データ量]を[時間]以内に取得 |

### 5.3 N+1問題の防止

| シナリオID | 説明 | 受入基準 |
|-----------|------|---------|
| PERF-N1-001 | [データ取得処理]時のSQL実行回数 | 1回のクエリで全データ取得（JOIN FETCH） |
| PERF-N1-002 | [データ取得処理]時のSQL実行回数 | 1回のクエリで全データ取得 |

---

## 6. セキュリティ受入基準

### 6.1 認証・認可

| シナリオID | 説明 | 受入基準 |
|-----------|------|---------|
| SEC-AUTH-001 | 未認証ユーザーのアクセス拒否 | 401 Unauthorized |
| SEC-AUTH-002 | 認証トークンの検証 | 不正なトークンは拒否 |
| SEC-AUTHZ-001 | 権限不足のユーザーのアクセス拒否 | 403 Forbidden |

### 6.2 データ保護

| シナリオID | 説明 | 受入基準 |
|-----------|------|---------|
| SEC-DATA-001 | パスワードのハッシュ化 | BCryptでハッシュ化されている |
| SEC-DATA-002 | 機密データの暗号化 | [暗号化方式]で暗号化されている |

---

## 7. 並行制御受入基準

### 7.1 楽観的ロック

| シナリオID | 説明 | 受入基準 |
|-----------|------|---------|
| CONC-OPT-001 | 並行更新時のバージョン競合 | 後から更新したユーザーは409 Conflict |
| CONC-OPT-002 | バージョン番号の自動インクリメント | 更新ごとにバージョンが1増加 |

---

## 8. 機能別シナリオ（Given-When-Then形式）

以下は、各機能の詳細なシナリオです。API単位の受入基準については、各APIディレクトリ配下のbehaviors.mdを参照してください。

### 8.X 機能 [FEATURE_ID]: [FEATURE_NAME]

### Scenario: [SCENARIO_NAME_1]

```gherkin
Given [前提条件]
When [アクション]
Then [期待される結果]
And [追加の期待結果]
```

* 受入基準:
  * [ ] [受入基準1]
  * [ ] [受入基準2]
  * [ ] [受入基準3]

### Scenario: [SCENARIO_NAME_2]

```gherkin
Given [前提条件]
When [アクション]
Then [期待される結果]
But [除外される結果]
```

### Scenario: [SCENARIO_NAME_3] (異常系)

```gherkin
Given [前提条件]
When [エラーを引き起こすアクション]
Then [エラーメッセージが表示される]
And [システムの状態は変更されない]
```

---

[必要に応じて追加の機能セクションを追加]

---

## 例外・エラーシナリオ

### [カテゴリ名1]

| シナリオ | 期待される動作 | エラーコード | テスト方法 |
|----------|-------------------|-------------|-----------|
| [シナリオ1] | [期待される動作] | [CODE] | [テスト方法] |
| [シナリオ2] | [期待される動作] | [CODE] | [テスト方法] |

### [カテゴリ名2]

| シナリオ | 期待される動作 | エラーコード | テスト方法 |
|----------|-------------------|-------------|-----------|
| [シナリオ1] | [期待される動作] | [CODE] | [テスト方法] |
| [シナリオ2] | [期待される動作] | [CODE] | [テスト方法] |

---

## エラーメッセージ一覧

### 検証エラー（VAL-xxx）

| コード | メッセージ | 発生条件 | 画面 |
|--------|-----------|---------|------|
| VAL-001 | [メッセージ] | [条件] | [画面] |
| VAL-002 | [メッセージ] | [条件] | [画面] |

### ビジネスエラー（BIZ-xxx）

| コード | メッセージ | 発生条件 | 例外クラス | 画面 |
|--------|-----------|---------|-----------|------|
| BIZ-001 | [メッセージ] | [条件] | [ExceptionClass] | [画面] |
| BIZ-002 | [メッセージ] | [条件] | [ExceptionClass] | [画面] |

---

## ビジネスルール参照

### [機能名1]（F-001）

| ルールID | 説明 | 影響するシナリオ |
|---------|-------------|-----------------|
| BR-001 | [説明] | [シナリオ名] |
| BR-002 | [説明] | [シナリオ名] |

---

## テスト実行チェックリスト

### 機能テスト

* [ ] [機能名1]: 全Xシナリオ実行
* [ ] [機能名2]: 全Yシナリオ実行

### 例外・エラーテスト

* [ ] [カテゴリ1]: 全Xケース実行
* [ ] [カテゴリ2]: 全Yケース実行

