# API_002_books - 書籍API受入基準

**API ID:** API_002_books  
**API名:** 書籍API  
**ベースパス:** `/api/books`  
**バージョン:** 2.0.0  
**最終更新日:** 2025-12-27

---

## 1. 概要

本文書は、書籍APIの受入基準を記述する。各エンドポイントについて、正常系・異常系の振る舞いを定義し、テストシナリオの基礎とする。

---

## 2. 書籍一覧取得 (`GET /api/books`)

### 2.1 正常系

| シナリオID | 説明 | Given（前提条件） | When（操作） | Then（期待結果） |
|-----------|------|----------------|------------|---------------|
| BOOK-LIST-001 | 全書籍を取得できる | 書籍が登録されている | /api/booksにリクエスト | 200 OK<br/>全書籍が返される<br/>カテゴリ、出版社、在庫情報を含む |
| BOOK-LIST-002 | 書籍が0件の場合、空配列を返す | 書籍が1件も登録されていない | /api/booksにリクエスト | 200 OK<br/>空配列 [] が返される |

---

## 3. 書籍詳細取得 (`GET /api/books/{id}`)

### 3.1 正常系

| シナリオID | 説明 | Given（前提条件） | When（操作） | Then（期待結果） |
|-----------|------|----------------|------------|---------------|
| BOOK-DETAIL-001 | 指定IDの書籍を取得できる | 書籍ID=1が存在する | /api/books/1にリクエスト | 200 OK<br/>書籍ID=1の情報が返される<br/>カテゴリ、出版社、在庫情報を含む |

### 3.2 異常系

| シナリオID | 説明 | Given（前提条件） | When（操作） | Then（期待結果） |
|-----------|------|----------------|------------|---------------|
| BOOK-DETAIL-E001 | 指定IDの書籍が存在しない場合、エラー | 書籍ID=999が存在しない | /api/books/999にリクエスト | 404 Not Found<br/>"書籍が見つかりません" |

---

## 4. 書籍検索 (`GET /api/books/search`)

### 4.1 正常系

| シナリオID | 説明 | Given（前提条件） | When（操作） | Then（期待結果） |
|-----------|------|----------------|------------|---------------|
| BOOK-SEARCH-001 | カテゴリIDで検索できる | カテゴリID=1の書籍が存在する | categoryId=1で検索リクエスト | 200 OK<br/>カテゴリID=1の書籍が返される |
| BOOK-SEARCH-002 | キーワードで検索できる | 書籍名に"Java"を含む書籍が存在する | keyword="Java"で検索リクエスト | 200 OK<br/>書籍名または著者名に"Java"を含む書籍が返される（部分一致） |
| BOOK-SEARCH-003 | カテゴリID+キーワードで検索できる | カテゴリID=1で書籍名に"Java"を含む書籍が存在する | categoryId=1&keyword="Java"で検索 | 200 OK<br/>カテゴリID=1かつ"Java"を含む書籍が返される |
| BOOK-SEARCH-004 | categoryId=0は全カテゴリを検索する | - | categoryId=0&keyword="Java"で検索 | 200 OK<br/>全カテゴリから"Java"を含む書籍が返される |
| BOOK-SEARCH-005 | パラメータ未指定で全書籍を返す | - | パラメータなしで検索リクエスト | 200 OK<br/>全書籍が返される |
| BOOK-SEARCH-006 | 検索結果が0件の場合、空配列を返す | 該当書籍なし | keyword="存在しないキーワード"で検索 | 200 OK<br/>空配列 [] が返される |

---

## 5. カテゴリ一覧取得 (`GET /api/books/categories`)

### 5.1 正常系

| シナリオID | 説明 | Given（前提条件） | When（操作） | Then（期待結果） |
|-----------|------|----------------|------------|---------------|
| BOOK-CAT-001 | 全カテゴリをMapで取得できる | カテゴリが登録されている | /api/books/categoriesにリクエスト | 200 OK<br/>カテゴリMapが返される<br/>{"Java": 1, "JavaScript": 2, ...} |

---

## 6. パフォーマンス受入基準

### 6.1 レスポンスタイム

| シナリオID | API | 受入基準 |
|-----------|-----|---------|
| PERF-001 | GET /api/books | 500ms以内（95パーセンタイル） |
| PERF-002 | GET /api/books/search | 500ms以内（95パーセンタイル） |

### 6.2 N+1問題の回避

| シナリオID | 説明 | 受入基準 |
|-----------|------|---------|
| PERF-010 | 書籍一覧取得時にN+1問題が発生しない | JOIN FETCHで一括取得<br/>SQLクエリ数が最小化されている |

---

## 7. 関連ドキュメント

- [functional_design.md](functional_design.md) - 書籍API機能設計書
- [../../system/behaviors.md](../../system/behaviors.md) - 全体受入基準
- [../../system/architecture_design.md](../../system/architecture_design.md) - アーキテクチャ設計書

